<%var delaysMax = 0%>
<%for (i=0; i < delays.length; i++) {%>
  <%if (delays[i] > delaysMax) {%>
    <%delaysMax = delays[i]%>
  <%}%>
<%}%>

node delay(X:bool; const R:int;) returns(Y:bool);
let
<%if (delays.length == 0){%>
  Y = X;<%}%>
 <% if (delays.length > 0){%>
  Y = if (R=0) then X
   <%for (i=1; i <= delaysMax; i++) {%>
      else if (R=<%-i%>) then delay<%-i%>(X)
   <%}%>
     else delay<%-parseInt(delaysMax)+1%>(X);
 <%}%>
tel

<%for (i=1; i <= parseInt(delaysMax)+1; i++) {%>
  node delay<%-i%>(X:bool) returns(Y:bool);
  var <%for (j=0; j < i; j++) {%> X_<%-j%>, <%}%>X_<%-i%> :bool;
  let

  X_0=X; <%for (j=1; j <= i; j++) {%>
  X_<%-j%>=false -> pre X_<%-j-1%>;<%}%>
  Y = X_<%-i%>;

  tel
<%}%>
